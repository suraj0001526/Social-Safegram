<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Safegram | Cyber Defense</title>
    <style>
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --accent: #ff6b6b;
            --success: #2ecc71;
            --dark: #2c3e50;
            --light: #f4f6f9;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--dark);
            min-height: 100vh;
        }

        /* Animated Background */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Fade In Animation */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 { margin: 0; background: linear-gradient(to right, #4e54c8, #8f94fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header p { margin: 5px 0 0; color: #666; font-size: 0.9rem; }

        .container { max-width: 900px; margin: 30px auto; padding: 20px; }

        /* Navigation Grid */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-btn {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            font-weight: 600;
            color: var(--dark);
            border-bottom: 4px solid transparent;
        }

        .nav-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        /* Specific Colors for Nav Items */
        .nav-btn:nth-child(1) { border-color: #ff6b6b; } /* Malware */
        .nav-btn:nth-child(2) { border-color: #feca57; } /* Phishing */
        .nav-btn:nth-child(3) { border-color: #54a0ff; } /* Stego */
        .nav-btn:nth-child(4) { border-color: #5f27cd; } /* Crypto */
        .nav-btn:nth-child(5) { border-color: #ff9f43; } /* Report */
        .nav-btn:nth-child(6) { border-color: #1dd1a1; } /* Learn */

        /* Main Card Styling */
        .card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fadeInUp 0.5s ease-out;
            display: none; /* Hidden by default */
        }

        .card h2 { 
            margin-top: 0; 
            font-size: 1.8rem; 
            border-bottom: 2px solid #f0f2f5; 
            padding-bottom: 15px;
            color: #444;
        }

        /* Inputs & Buttons */
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0 20px 0;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: 0.3s;
            box-sizing: border-box;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(143, 148, 251, 0.2);
        }

        button {
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(78, 84, 200, 0.4);
        }

        button:active { transform: scale(0.98); }

        /* Results Box */
        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 5px solid var(--primary);
            border-radius: 6px;
            display: none;
            animation: fadeInUp 0.3s;
        }
        
        .result-box.error { border-left-color: var(--accent); background: #fff5f5; color: #c0392b; }

        /* Emergency Section Styling */
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid;
        }
        .info-india { background: #fff9db; border-color: #f1c40f; }
        .info-global { background: #e3f2fd; border-color: #3498db; }
        .info-action { background: #f3e5f5; border-color: #9b59b6; margin-top: 20px; }
        
        a.official-link {
            display: inline-block;
            margin-top: 10px;
            background: var(--dark);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        a.official-link:hover { background: black; }

        /* File Input Styling */
        input[type="file"] {
            background: #f8f9fa;
            padding: 10px;
        }

    </style>
</head>
<body>

<div class="header">
    <h1>üõ°Ô∏è Social Safegram</h1>
    <p>Advanced AI Cyber Protection Suite</p>
</div>

<div class="container">

    <div class="nav-grid">
        <div class="nav-btn" onclick="showSection('malware')">
            <div style="font-size: 24px;">ü¶†</div>
            <div>Malware Scan</div>
        </div>
        <div class="nav-btn" onclick="showSection('phishing')">
            <div style="font-size: 24px;">üé£</div>
            <div>Phishing Check</div>
        </div>
        <div class="nav-btn" onclick="showSection('stego')">
            <div style="font-size: 24px;">üñºÔ∏è</div>
            <div>Steganography</div>
        </div>
        <div class="nav-btn" onclick="showSection('crypto')">
            <div style="font-size: 24px;">üîê</div>
            <div>Secure Chat</div>
        </div>
        <div class="nav-btn" onclick="showSection('report')">
            <div style="font-size: 24px;">üëÆ</div>
            <div>Report Crime</div>
        </div>
        <div class="nav-btn" onclick="showSection('awareness')">
            <div style="font-size: 24px;">üß†</div>
            <div>Awareness</div>
        </div>
    </div>

    <div id="malware" class="card">
        <h2>ü¶† Malware File Detector</h2>
        <p>Upload any executable file (.exe) to analyze its internal structure using Machine Learning.</p>
        
        <label>Select File:</label>
        <input type="file" id="malwareFile">
        
        <button type="button" onclick="scanMalware()">üöÄ Scan For Viruses</button>
        <div id="malwareResult" class="result-box"></div>
    </div>

    <div id="phishing" class="card">
        <h2>üé£ Link Safety Checker</h2>
        <p>Analyze suspicious URLs for phishing patterns and fraud indicators.</p>
        
        <input type="text" id="phishingUrl" placeholder="Paste URL here (e.g. http://suspicious-bank.com)">
        
        <button class="btn-primary" onclick="analyzeLink()">Analyze</button>
        <div id="phishingResult" class="result-box"></div>
    </div>

    <div id="stego" class="card">
        <h2>üñºÔ∏è Steganography Tool</h2>
        <p>Hide secret text inside an image so no one knows it exists.</p>

        <div style="display:flex; gap:20px; flex-wrap:wrap;">
            <div style="flex:1;">
                <h3>üîí Hide Message</h3>
                <input type="text" id="stegoText" placeholder="Secret Message">
                <input type="file" id="stegoInputFile" accept="image/png">
                <button type="button" onclick="hideMessage()">Encode & Download</button>
                <div id="stegoHideResult" class="result-box"></div>
            </div>
            
            <div style="flex:1; border-left: 2px solid #eee; padding-left: 20px;">
                <h3>üîì Reveal Message</h3>
                <input type="file" id="stegoRevealFile" accept="image/png">
                <button type="button" onclick="revealMessage()" style="background: linear-gradient(to right, #11998e, #38ef7d);">Decode Image</button>
                <div id="stegoRevealResult" class="result-box"></div>
            </div>
        </div>
    </div>

    <div id="crypto" class="card">
        <h2>üîê Encryption Lab</h2>
        <p>Secure your text with military-grade AES-256 encryption.</p>
        
        <div style="background: #f0f2f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <button type="button" onclick="getKey()" style="background: #f39c12; width: auto;">üîë Generate New Key</button>
            <div id="keyDisplay" style="margin-top:10px; font-family: monospace; font-weight: bold; word-break: break-all;"></div>
        </div>

        <h3>Encrypt</h3>
        <input type="text" id="encryptText" placeholder="Message to hide">
        <input type="text" id="encryptKey" placeholder="Paste Key">
        <button type="button" onclick="doEncrypt()">üîí Encrypt</button>
        <div id="encryptResult" class="result-box"></div>

        <h3>Decrypt</h3>
        <input type="text" id="decryptText" placeholder="Encrypted Code">
        <input type="text" id="decryptKey" placeholder="Paste Key">
        <button type="button" onclick="doDecrypt()" style="background: linear-gradient(to right, #43cea2, #185a9d);">üîì Decrypt</button>
        <div id="decryptResult" class="result-box"></div>
    </div>

    <div id="report" class="card">
        <h2>üëÆ Cybercrime Reporting Assistant</h2>
        <p>Auto-generate a formal PDF complaint for local authorities.</p>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <input type="text" id="repName" placeholder="Victim Name">
            <input type="text" id="repContact" placeholder="Contact Info">
        </div>
        
        <select id="repType">
            <option value="Financial Fraud">Financial Fraud</option>
            <option value="Social Media Hacking">Social Media Hacking</option>
            <option value="Cyber Bullying">Cyber Bullying</option>
            <option value="Phishing">Phishing</option>
        </select>
        
        <label>Incident Date:</label>
        <input type="date" id="repDate">
        
        <textarea id="repDesc" rows="4" placeholder="Describe the incident in detail..."></textarea>
        
        <label>Upload Evidence (Screenshots):</label>
        <input type="file" id="repFiles" multiple accept="image/*">
        
        <button type="button" onclick="downloadReport()" style="background: #e74c3c; margin-top: 15px;">üì• Download Official PDF Report</button>

        <h3 style="margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">üö® Emergency Resources</h3>
        
        <div class="emergency-grid">
            <div class="info-card info-india">
                <h4>üáÆüá≥ India Helplines</h4>
                <ul style="padding-left: 20px;">
                    <li><b>1930</b> - National Cyber Helpline</li>
                    <li><b>112</b> - Police Emergency</li>
                </ul>
                <a href="https://cybercrime.gov.in" target="_blank" class="official-link">Open CyberCrime.gov.in</a>
            </div>

            <div class="info-card info-global">
                <h4>üåç Global / USA</h4>
                <ul style="padding-left: 20px;">
                    <li><b>FBI IC3</b> - Internet Crime</li>
                    <li><b>CISA</b> - Malware Reporting</li>
                </ul>
                <a href="https://www.ic3.gov/" target="_blank" class="official-link">Open FBI IC3</a>
            </div>
        </div>

        <div class="info-card info-action">
            <h4>üõë Immediate Action Plan</h4>
            <ol style="margin:0; padding-left: 20px;">
                <li>Call <b>1930</b> immediately (Golden Hour).</li>
                <li>Block Debit/Credit cards via Banking App.</li>
                <li>Change all passwords.</li>
            </ol>
        </div>
    </div>

    <div id="awareness" class="card">
        <h2>üí° Cyber Prevention Tips</h2>
        <p>Follow these 15 rules to stay safe online.</p>
        
        <div id="tips-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
            <p>‚è≥ Loading tips from server...</p>
        </div>
    </div>
<script>
    // FIX: Force correct server URL
    const BASE_URL = window.location.origin;

    // Show first section by default
    document.addEventListener('DOMContentLoaded', () => {
        showSection('malware');
    });

    function showSection(id) {
        document.querySelectorAll('.card').forEach(el => el.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- MALWARE ---
    async function scanMalware() {
        let fileInput = document.getElementById('malwareFile');
        if(fileInput.files.length === 0) { alert("Please upload a file first."); return; }
        
        let btn = event.target;
        btn.innerHTML = "‚è≥ Scanning...";
        
        let formData = new FormData();
        formData.append("file", fileInput.files[0]);

        try {
            let res = await fetch(BASE_URL + '/scan-file/', { method: 'POST', body: formData });
            let data = await res.json();
            let div = document.getElementById('malwareResult');
            div.style.display = 'block';
            
            if(data.error) {
                div.innerHTML = "‚ùå " + data.error;
                div.className = "result-box error";
            } else {
                div.innerHTML = `
                    <h3 style="margin-top:0">${data.status}</h3>
                    <p><b>Risk Score:</b> ${data.risk_score}</p>
                    <p><b>Threat Level:</b> ${data.risk_level}</p>
                `;
                div.className = "result-box";
            }
        } catch (e) { alert("Connection Failed. Is the server running?"); }
        btn.innerHTML = "üöÄ Scan For Viruses";
    }

    // --- PHISHING ---
    async function analyzeLink() {
        // 1. Match the ID from your HTML (<input id="phishingUrl">)
        const inputElement = document.getElementById('phishingUrl');
        const resultBox = document.getElementById('phishingResult');
        
        if (!inputElement || !resultBox) {
            console.error("Error: HTML elements not found. Check IDs!");
            return;
        }

        const url = inputElement.value;
        if (!url) { 
            alert("Please paste a URL first."); 
            return; 
        }

        // Show loading state
        resultBox.style.display = 'block';
        resultBox.innerHTML = "<p>üîç Scanning global databases...</p>";

        try {
            // 2. Send to Python Backend
            const response = await fetch('/scan-url/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: url })
            });

            const data = await response.json();

            // 3. Define Color based on Risk
            let color = "orange"; // Default warning
            if (data.risk_level === "SAFE") color = "green";
            if (data.risk_level === "CRITICAL") color = "red";

            // 4. Inject the Results HTML (Since your div is empty)
            resultBox.innerHTML = `
                <div style="border: 2px solid ${color}; padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <h3 style="color: ${color}; margin-top: 0;">${data.risk_level}</h3>
                    <p><strong>Safety Score:</strong> ${data.risk_score}/100</p>
                    <p><strong>Flags:</strong> ${data.flags}</p>
                </div>
            `;

        } catch (error) {
            console.error("Scan Error:", error);
            resultBox.innerHTML = `<p style="color: red;">‚ùå Connection Error: Is the server running?</p>`;
        }
    }

    // --- STEGO ---
    async function hideMessage() {
        let text = document.getElementById('stegoText').value;
        let fileInput = document.getElementById('stegoInputFile');
        
        if (!text || fileInput.files.length === 0) { 
            alert("Please enter text and select a PNG file."); 
            return; 
        }

        let formData = new FormData();
        // These names MUST match the Python function arguments exactly!
        formData.append("message", text);  
        formData.append("file", fileInput.files[0]);

        try {
            let res = await fetch(BASE_URL + '/stego/hide/', { method: 'POST', body: formData });
            
            if (res.status === 200) {
                let blob = await res.blob();
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement('a');
                a.href = url;
                a.download = "secret_image.png";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                document.getElementById('stegoHideResult').style.display = 'block';
                document.getElementById('stegoHideResult').innerText = "‚úÖ Downloaded!";
            } else { 
                // This will print the EXACT error from the server (e.g. "field required")
                let errorData = await res.json();
                console.log("Server Error:", errorData); 
                alert("Error: " + JSON.stringify(errorData)); 
            }
        } catch (e) { alert("Server Error: " + e); }
    }
    async function revealMessage() {
        let fileInput = document.getElementById('stegoRevealFile');
        if(!fileInput.files[0]) return;
        let formData = new FormData();
        formData.append("file", fileInput.files[0]);
        let res = await fetch(BASE_URL + '/stego/reveal/', { method: 'POST', body: formData });
        let data = await res.json();
        let div = document.getElementById('stegoRevealResult');
        div.style.display = 'block';
        div.innerHTML = data.status === 'success' ? `<b>Secret Found:</b> <br> ${data.message}` : "‚ùå No secret found.";
    }

    // --- CRYPTO ---
    async function getKey() {
        let res = await fetch(BASE_URL + '/crypto/get-key/');
        let data = await res.json();
        document.getElementById('keyDisplay').innerText = data.key;
    }

    async function doEncrypt() {
        let text = document.getElementById('encryptText').value;
        let key = document.getElementById('encryptKey').value;
        let res = await fetch(BASE_URL + '/crypto/encrypt/', { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text, key}) 
        });
        let data = await res.json();
        let div = document.getElementById('encryptResult'); div.style.display='block';
        div.innerText = data.encrypted_text || "Error";
    }

    async function doDecrypt() {
        let text = document.getElementById('decryptText').value;
        let key = document.getElementById('decryptKey').value;
        let res = await fetch(BASE_URL + '/crypto/decrypt/', { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text, key}) 
        });
        let data = await res.json();
        let div = document.getElementById('decryptResult'); div.style.display='block';
        div.innerText = data.decrypted_text || "Error";
    }

    // --- REPORT ---
    // --- REPORT FIX ---
    async function downloadReport() {
        let formData = new FormData();
        
        // Manual mapping to ensure names match Python exactly
        formData.append("name", document.getElementById('repName').value);
        formData.append("contact", document.getElementById('repContact').value);
        formData.append("type", document.getElementById('repType').value);
        formData.append("date", document.getElementById('repDate').value);
        
        // This was the error: sending "desc" instead of "description"
        formData.append("description", document.getElementById('repDesc').value);
        
        // Append files
        let files = document.getElementById('repFiles').files;
        for(let i=0; i<files.length; i++) {
            formData.append("files", files[i]);
        }

        let btn = event.target; 
        btn.innerText = "‚è≥ Generating...";
        btn.disabled = true;

        try {
            let res = await fetch(BASE_URL + '/report/generate/', { method: 'POST', body: formData });
            
            if(res.status === 200) {
                let blob = await res.blob();
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement('a');
                a.href = url;
                a.download = "Incident_Report.pdf";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                btn.innerText = "‚úÖ Report Downloaded!";
            } else {
                let errText = await res.text();
                alert("Server Error (" + res.status + "): " + errText);
                btn.innerText = "‚ö†Ô∏è Try Again";
            }
        } catch (e) {
            alert("Connection Error: " + e);
            btn.innerText = "‚ö†Ô∏è Connection Failed";
        }
        
        setTimeout(() => { btn.disabled = false; btn.innerText = "üì• Download Official PDF Report"; }, 3000);
    }

   // --- LOAD AWARENESS TIPS ---
    async function loadTips() {
        console.log("Fetching Tips...");
        try {
            // ‚úÖ FIX 1: Match the Python endpoint exactly
            let res = await fetch(BASE_URL + '/awareness/tips/');
            
            if (!res.ok) {
                throw new Error(`Server returned status: ${res.status}`);
            }

            // ‚úÖ FIX 2: The Python code returns a List directly, not a Dictionary
            let tips = await res.json(); 
            
            let html = "";
            tips.forEach(t => {
                html += `
                <div class="tip-card">
                    <div class="tip-icon">${t.icon}</div>
                    <div class="tip-title">${t.title}</div>
                    <div class="tip-desc">${t.desc}</div>
                </div>`;
            });
            
            document.getElementById('tips-grid').innerHTML = html;

        } catch (e) {
            console.error("Error loading tips:", e);
            document.getElementById('tips-grid').innerHTML = "<p style='color:red'>Failed to load tips. Is server running?</p>";
        }
    }
    
    // Ensure this runs on load
    window.onload = function() {
        // scanMalware(); // Optional: remove if you don't want it running immediately
        loadTips();
    };

</script>
</body>
</html>